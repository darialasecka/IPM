<!DOCTYPE html>
<html>
<head>
  <meta http-equiv = "Content-Type" content = "text/html; charset = utf-8" />
  <script type = "text/javascript">
    var index = 0;

         //prefixes of implementation that we want to test
         window.indexedDB = window.indexedDB || window.mozIndexedDB ||
         window.webkitIndexedDB || window.msIndexedDB;

         //prefixes of window.IDB objects
         window.IDBTransaction = window.IDBTransaction ||
         window.webkitIDBTransaction || window.msIDBTransaction;
         window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange ||
         window.msIDBKeyRange

         if (!window.indexedDB) {
            window.alert("Your browser doesn't support a stable version of IndexedDB.")
         }

         const contactData = [
            { id: index++, name: "Bob", last: "Kowalski", phone_number: "123456789" },
            { id: index++, name: "Kuba", last: "Nowak", phone_number: "123123123" }
         ];
         var db;
         var request = window.indexedDB.open("contactsDB", 1);

         request.onerror = function(event) {
            console.log("error: ");
         };

         request.onsuccess = function(event) {
            db = request.result;
            console.log("success: "+ db);
         };

         request.onupgradeneeded = function(event) {
            var db = event.target.result;
            var objectStore = db.createObjectStore("contact", {keyPath: "id"});

            for (var i in contactData) {
               objectStore.add(contactData[i]);
            }
         }

         function readAll() {
            var objectStore = db.transaction("contact").objectStore("contact");

            objectStore.openCursor().onsuccess = function(event) {
               var cursor = event.target.result;

               if (cursor) {
                  alert("Name for id " + cursor.key + " is " + cursor.value.name + ", phone_number: " + cursor.value.phone_number);
                  cursor.continue();
               } else {
                  alert("No more entries!");
               }
            };
         }

         function add() {
            var name = document.getElementById("name").value;
            var last_name = document.getElementById("last").value;
            var phone_number = document.getElementById("phone_number").value;

            var request = db.transaction(["contact"], "readwrite")
            .objectStore("contact")
            .add({ id: index++, name: name, last:last, phone_number: phone_number });

            request.onsuccess = function(event) {
               alert("Kenny has been added to your database.");
            };

            request.onerror = function(event) {
               alert("Unable to add data\r\nKenny is aready exist in your database! ");
            }
         }

         function removeAll() {
            for(var i = 0; i < index ; i++){
              var request = db.transaction(["contact"], "readwrite")
              .objectStore("contact")
              .delete(i);
              }
            index = 0;

            request.onsuccess = function(event) {
               alert("All data is removed.");
            };
         }
      </script>

</head>
<body>

<form>
  <label for="name"> First name: </label>
  <input type="text" id="name" name="name" required/> </br> </br>

  <label for="last"> Last name: </label>
  <input type="text" id="last" name="last" required/> </br> </br>

  <label for="phone_number"> Phone number: </label>
  <input type="text" id="phone_number" name="phone_number" pattern="[0-9]{9}$"  placeholder="123123123" required/> </br> </br>

  <input type="submit" id="submit" name="submit" value="Add" onclick="add()"></input>
</form>


<button onclick = "read()">Read </button>
<button onclick = "readAll()">Read all </button>
<button onclick = "add()">Add data </button>
<button onclick = "removeAll()">Delete all data </button>
</body>
</html>